#///////////////////////////////////////////////////
#
#	nmake makefile
#	Copyright 2007 Tassilo Philipp
#	Nmakefile
#
#///////////////////////////////////////////////////


TOP = ..\..

!INCLUDE $(TOP)\build\nmake\prolog.nmake


AUTOS = config.h case.h


!IF "$(BUILD_OS)" == "Windows"

TARGETS = ellipse.exe
OBJS = main.obj ellipse.obj ..\main_Windows.obj

$(TARGETS): $(OBJS)
	echo Linking $@ ...
	$(LD) /OUT:"$@" $(LDFLAGS) $(OBJS) $(TOP)\dyncall\libdyncall_s.lib > nul


!ELSE IF "$(BUILD_OS)" == "NDS"

TARGETS = ellipse.nds
OBJS = main.o ellipse.o ..\main_NDS.o

$(TARGETS): $(OBJS)
	echo Linking $@ ...
	$(LD) $(LDFLAGS) $(OBJS) $(DEVKITPRO_PATH)\libnds\lib\libnds9.a $(TOP)/dyncall/libdyncall_s.a -o "$(@B).elf"
	$(OCP) -O binary "$(@B).elf" "$(@B).arm9"
	ndstool -c "$@" -9 "$(@B).arm9"
	del "$(@B).elf" "$(@B).arm9"

!ENDIF



$(OBJS): $(AUTOS)

$(AUTOS): mkcase.py
	mkcase.py >case.h 2>config.h


!INCLUDE $(TOP)\build\nmake\epilog.nmake

