#//////////////////////////////////////////////////////////////////////////////
# GNU Make Buildsystem
# Microsoft Visual C++
#//////////////////////////////////////////////////////////////////////////////

OBJ_SUFFIX	 = .obj
LIB_SUFFIX	 = .lib

CXXFLAGS	+= /EHsc

# --- assemble to coff --------------------------------------------------------

$(BUILD_DIR)/%.obj: %.asm
	ml /nologo /c /coff $(ASFLAGS) /Fo$@ $<

# --- compile C ---------------------------------------------------------------

$(BUILD_DIR)/%.obj: %.c
	cl $< /nologo /c $(CPPFLAGS) $(CFLAGS) /Fo$@ 


# --- compile C++ -------------------------------------------------------------

$(BUILD_DIR)/%.obj: %.cpp
	cl $< /nologo /c $(CPPFLAGS) $(CXXFLAGS) /Fo$@ 

# --- build static library ----------------------------------------------------

$(BUILD_DIR)/%.lib: 
	lib /OUT:$@ /NOLOGO $^

# --- Link flags --------------------------------------------------------------

LDFLAGS += $(foreach X,$(LINK_PATHS),/LIBPATH:$X)
LDFLAGS += $(foreach X,$(LINK_LIBS),$X.lib)

# --- build dynamic linked library --------------------------------------------

$(BUILD_DIR)/%.dll: 
	link /OUT:$@ /NOLOGO /MACHINE:X86 /DLL $(LDFLAGS) $^

# --- build executable --------------------------------------------------------

$(BUILD_DIR)/%.exe: 
	link /OUT:$@ /NOLOGO /MACHINE:x86 $(LDFLAGS) $^

